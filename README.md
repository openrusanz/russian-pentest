# russian-pentest
Миссия проекта: 
1) привлечь внимание к проблеме отсутствия "прозрачности" в услугах анализа защищенности;
2) провести систематизацию текущих требования регуляторов к организации (в контексте анализа защищенности).

# Внутренний пентест:

## LLMNR/NBT-NS Poisoning

Данная атака позволяет захватывать Net-NTLM хеши, из которых путем перебора можно получить пару логин/пароль конкретного пользователя, что можно использовать на других этапах анализа защищенности. 
Атаку рекомендуется проводить либо рано утром – когда сотрудники Заказчика только начинают работу, либо после обеда – когда они же возвращаются к своим рабочим станциям.
В общем случае проведение атаки сводится к следующей последовательности действий:

1.	Запустить Responder:
> responder -I <interface> -rdw 
	
Запуск с текущими параметрами может негативно отразиться на сети.

2.	Подождать достаточный промежуток времени.
Захваченные хеши по умолчанию расположены в /usr/share/responder/logs. Для вывода захваченных хешей удобно воспользоваться DumpHash.py, расположенным в /usr/share/responder.

Получив первые хеши, рекомендуется воспользоваться «ldapdomaindump» с целью получения таблицы LDAP.
	
## IPv6 - Атака
Если в корпоративной сети используется IPv6, атакующий может ответить на запросы DHCPv6 и установить в качестве DNS-сервера на атакуемой машине свой IP-адрес. Так как IPv6 имеет приоритет над IPv4, DNS-запросы клиента будут отправлены на адрес атакующего. Запуск атаки:
> mitm6 -d domain.local

Где «domain.local» - атакуемый домен. При помощи данной атаки возможно осуществить:
1.	Сбор Net-NTLM хешей: (проверить просто респондером)
> smbserver.py -smb2support SMB /root/SMB

2.	Атаки на LDAP(S) при подделке WPAD:
Как только жертва установит атакующего в качестве DNS-сервера IPv6, она начнет запрашивать конфигурацию сети WPAD. Атакующий отправляет жертве действительный WPAD, в котором он является прокси-сервером. Когда жертва подключается к «прокси-серверу», он запрашивает NetNTLM аунтентификацию, полученный хеш пересылается дальше на атакуемый ресурс. Подробнее. (https://blog.fox-it.com/2018/01/11/mitm6-compromising-ipv4-networks-via-ipv6/)

 > ntlmrelayx.py -6 -t ldaps://<DC> -wh fakewpad.domain.local -l loot_folder
	
Эта атака может быть произведена так же в любом другом случае при компрометации DNS-сервера.
В обычно случае будет собрана база данных LDAP, как в атаке выше (вставить ссылку на LDAP). Если же будет пойман NetNTLM хеш администратора домена, будет совершена попытка создать нового пользователя на КД, что может привести к его компрометации. Данная атака будет работать даже с включенной SMB подписью.
